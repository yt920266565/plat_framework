<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.yanmade.plat.report.dao.SummaryHourMapper">

	<select id="listHourReports" parameterType="Map"
		resultType="java.util.Map">
		select machineId,${sql}, workArea, partName, workshop, productType from summary_hour
		<where>
			<if test="machineId != null and machineId != ''">
				and machineId like concat(#{machineId}, '%')
			</if>
			<if test="partName != null and partName != ''">
				and partName = #{partName}
			</if>
			<if test="workArea != null and workArea != ''">
				and workArea = #{workArea}
			</if>
			<if test="workshop != null and workshop != ''">
				and workshop = #{workshop}
			</if>
			and dutyDate = #{date}
		</where>
		group by workArea, workshop, productType, partName, machineId order by workArea, workshop, productType, partName, machineId asc
		limit #{page},#{limit}
	</select>

	<select id="listDateHours" parameterType="Map"
		resultType="string">
		select distinct(testHour) from summary_hour
		<where>
			<if test="partName != null and partName != ''">
				and partName = #{partName}
			</if>
			<if test="workArea != null and workArea != ''">
				and workArea = #{workArea}
			</if>
			<if test="workshop != null and workshop != ''">
				and workshop = #{workshop}
			</if>
			and dutyDate = #{date}
		</where>
	</select>

	<select id="countHoursReportCnt" parameterType="Map"
		resultType="int">
		select count(distinct(concat(machineId, ',' , workArea, ',' , partName, ',' , workshop))) from summary_hour
		<where>
			<if test="partName != null and partName != ''">
				and partName = #{partName}
			</if>
			<if test="workArea != null and workArea != ''">
				and workArea = #{workArea}
			</if>
			<if test="workshop != null and workshop != ''">
				and workshop = #{workshop}
			</if>
			and dutyDate = #{date}
		</where>
	</select>

	<select id="countSummaryHour" parameterType="com.yanmade.plat.report.entity.SummaryHour" resultType="int">
		select count(*) from summary_hour where ip = #{ip} and dutyDate = #{dutyDate} and duty = #{duty} and testHour = #{testHour}
	</select>

	<select id="listWorkshops" parameterType="map" resultType="string">
		select distinct(workArea) from summary_day
		<where>
			<if test="partName != null and partName != ''">
				and partName = #{partName}
			</if>
			<if test="workArea != null and workArea != ''">
				and workArea = #{workArea}
			</if>
			and dutyDate = #{date}
		</where>
		order by workArea asc
	</select>

</mapper>