<?xml version="1.0" encoding="utf-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.yanmade.plat.report.dao.SummaryAlarmMapper">

    <select id="listSummaryAlarmBySummaryDuty" parameterType="com.yanmade.plat.report.entity.SummaryAlarmQueryDto" resultType="com.yanmade.plat.report.entity.SummaryDuty">
        select machineId, workArea, workshop, partName, productType, duty, waitDuaration, stopDuaration,
        top1AlarmItem, top1AlarmCount, top2AlarmItem, top2AlarmCount, top3AlarmItem, top3AlarmCount from summary_duty
        <where>
            <if test="machineId != null and machineId != ''">
                and machineId like concat(#{machineId}, '%')
            </if>
            <if test="partName != null and partName != ''">
                and partName = #{partName}
            </if>
            <if test="workArea != null and workArea != ''">
                and workArea = #{workArea}
            </if>
            <if test="workshop != null and workshop != ''">
                and workshop = #{workshop}
            </if>
            and dutyDate = #{date}
        </where>
        order by workArea, workshop, productType, partName, machineId, duty, top1AlarmCount asc
        limit #{page},#{limit}
    </select>

    <select id="countSummaryAlarmBySummaryDuty" parameterType="com.yanmade.plat.report.entity.SummaryAlarmQueryDto" resultType="int">
        select count(machineId) from summary_duty
        <where>
            <if test="machineId != null and machineId != ''">
                and machineId like concat(#{machineId}, '%')
            </if>
            <if test="partName != null and partName != ''">
                and partName = #{partName}
            </if>
            <if test="workArea != null and workArea != ''">
                and workArea = #{workArea}
            </if>
            <if test="workshop != null and workshop != ''">
                and workshop = #{workshop}
            </if>
            and dutyDate = #{date}
        </where>
        order by workArea, workshop, productType, partName, machineId asc
    </select>

    <select id="listSingleMachineMultipleDaysTop3AlarmTotal" parameterType="Map" resultType="com.yanmade.plat.report.entity.SummaryDuty">
        select machineId, top1AlarmItem, top1AlarmCount, top2AlarmItem, top2AlarmCount, top3AlarmItem, top3AlarmCount from summary_duty
        where machineId = #{machineId} and dutyDate >= #{startDate} and dutyDate &lt;= #{endDate}
    </select>

</mapper>