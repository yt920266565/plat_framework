<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.yanmade.plat.report.dao.SummaryDayMapper">

	<select id="listDayReports" parameterType="Map" resultType="Map">
		select machineId,${sql}, workshop, partName, workArea, productType from summary_day
		<where>
			<if test="machineId != null and machineId != ''">
				and machineId like concat(#{machineId}, '%')
			</if>
			<if test="partName != null and partName != ''">
				and partName = #{partName}
			</if>
			<if test="workshop != null and workshop != ''">
				and workshop = #{workshop}
			</if>
			<if test="workArea != null and workArea != ''">
				and workArea = #{workArea}
			</if>
			and dutyDate >= #{startDate} and dutyDate &lt;= #{endDate}
		</where>
		group by workArea, workshop, productType, partName, machineId order by workArea, workshop, productType, partName, machineId asc
		limit #{page},#{limit}
	</select>

	<select id="listDayDates" parameterType="Map" resultType="string">
		select distinct(dutyDate) from summary_day
		<where>
			<if test="partName != null and partName != ''">
				and partName = #{partName}
			</if>
			<if test="workshop != null and workshop != ''">
				and workshop = #{workshop}
			</if>
			<if test="workArea != null and workArea != ''">
				and workArea = #{workArea}
			</if>
			and dutyDate >= #{startDate} and dutyDate &lt;= #{endDate}
		</where>
	</select>

	<select id="countDayReportsCnt" parameterType="Map" resultType="int">
		select count(distinct(concat(machineId, ',' , workshop, ',' , partName, ',', workArea))) from summary_day
		<where>
			<if test="partName != null and partName != ''">
				and partName = #{partName}
			</if>
			<if test="workshop != null and workshop != ''">
				and workshop = #{workshop}
			</if>
			<if test="workArea != null and workArea != ''">
				and workArea = #{workArea}
			</if>
			and dutyDate >= #{startDate} and dutyDate &lt;= #{endDate}
		</where>
	</select>

	<select id="countSummaryDay" parameterType="com.yanmade.plat.report.entity.SummaryDay" resultType="int">
		select count(*) from summary_day where ip = #{ip} and dutyDate = #{dutyDate}
	</select>

	<select id="listWorkshops" parameterType="String" resultType="string">
		select distinct(workshop) from summary_day
		<where>
			<if test="workArea != null and workArea != ''">
				and workArea = #{workArea}
		   </if>
		</where>
		order by workshop asc
	</select>

	<select id="listWorkAreas" resultType="com.yanmade.plat.report.entity.WorkAreaDto">
		select workArea, count(distinct(machineId)) as machineCount from summary_day group by workArea
	</select>

	<select id="getPassCountByProductType" parameterType="map" resultType="com.yanmade.plat.report.entity.SummaryDay">
		select productType, workArea, dutyDate, sum(totalCount) as totalCount, sum(firstPassCount) as firstPassCount from summary_day
		where workArea = #{workArea} and dutyDate >= #{startDate} and dutyDate &lt;= #{endDate}
		<if test="productType != null and productType != ''">
			and productType = #{productType}
		</if>
		<if test="partName != null and partName != ''">
			and partName = #{partName}
		</if>
		<if test="testType != null and testType != ''">
			and testType = #{testType}
		</if>
		group by productType, workArea, dutyDate
	</select>

	<select id="listProductTypes" parameterType="String" resultType="String">
		select distinct(productType) from summary_day where workArea = #{workArea} order by productType desc
	</select>

	<select id="listPartNames" parameterType="String" resultType="String">
		select distinct(partName) from summary_day where workArea = #{workArea} order by partName desc
	</select>

	<select id="listTestTypes" parameterType="String" resultType="String">
		select distinct(testType) from summary_day where workArea = #{workArea} order by testType desc
	</select>

</mapper>