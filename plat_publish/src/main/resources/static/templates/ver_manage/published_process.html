<!DOCTYPE html>
<html lang="zh-cn">
<head>
<meta charset="utf-8">
<title>已发布版本查询</title>
<meta name="renderer" content="webkit">
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
<meta name="viewport"
	content="width=device-width, initial-scale=1, maximum-scale=1">
<link rel="stylesheet" type="text/css"
	href="../../layui-v2.5.6/layui/css/layui.css">
<script type="text/javascript" src="../../js/jquery-2.1.1.min.js"></script>
</head>
<style type="text/css">
.layui-textarea {
	width: 81%;
}
.layui-tab {
    margin: 0px 0;
    text-align: left!important;
     padding: 10px;
}

.layui-form-item {
    margin-bottom: 8px;
    clear: both;
    *zoom: 1;
}

</style>
<body style="">

	<div class="layui-tab layui-tab-card">
		<ul class="layui-tab-title">
			<li class="layui-this">版本申请</li>
			<li>版本构建测试</li>
			<li>版本发布日志</li>
		</ul>
		<div class="layui-tab-content" >
			<div class="layui-tab-item layui-show">
				<form class="layui-form" action="" style="margin-top: 20px">
					<div class="layui-form-item">
						<label class="layui-form-label">项目名称</label>
						<div class="layui-input-block">
							<input type="text" name="projName" id="projName"
								lay-verify="title" autocomplete="off" class="layui-input"
								style="width: 81%">
						</div>
					</div>

					<div class="layui-form-item">
						<div class="layui-inline">
							<label class="layui-form-label">产品线</label>
							<div class="layui-input-inline">
								<select id="deptId">
									<option value="">选择或搜索</option>
									<option value="134">产品一部</option>
									<option value="132">产品二部</option>
									<option value="133">产品三部</option>
									<option value="135">产品四部</option>
									<option value="162">产品五部</option>
									<option value="136">派科斯</option>
									<option value="155">软件部</option>
								</select>
							</div>
						</div>
						<div class="layui-inline">
							<label class="layui-form-label">客户名称</label>
							<div class="layui-input-inline">
								<select id="client" lay-search="">
									<option value="">选择或搜索</option>
								</select>
							</div>
						</div>
						<div class="layui-inline">
							<label class="layui-form-label" style="width: 84px">被测产品大类</label>
							<div class="layui-input-inline">
								<select id="product" lay-search="">
									<option value="">选择或搜索</option>
								</select>
							</div>
						</div>
						<div class="layui-inline">
							<label class="layui-form-label layui-required">料号</label>
							<div class="layui-input-inline">
								<input type="text" name="subPartNo" lay-verify="required"
									id="subPartNo" autocomplete="off" class="layui-input">
							</div>
						</div>
					</div>
					<div class="layui-form-item">
						<div class="layui-inline">
							<label class="layui-form-label">测试类型</label>
							<div class="layui-input-inline">
								<select id="testType" lay-search="">
									<option value="">选择或搜索</option>
								</select>
							</div>
						</div>
						<div class="layui-inline">
							<label class="layui-form-label">版本类型</label>
							<div class="layui-input-inline">
								<select id="verType" lay-search="">
									<option value="">选择或搜索</option>
									<option value="1">正式版本</option>
									<option value="2">临时版本</option>
								</select>
							</div>
						</div>
						<div class="layui-inline">
							<label class="layui-form-label">版本层级</label>
							<div class="layui-input-inline">
								<select id="verlevel" lay-search="">
									<option value="">选择或搜索</option>
									<option value="1">产品</option>
									<option value="2">上位机</option>
									<option value="3">下位机</option>
									<option value="4">模块</option>
								</select>
							</div>
						</div>
						<div class="layui-inline">
							<label class="layui-form-label ">版本包属性</label>
							<div class="layui-input-inline">
								<select id="pkgType" lay-search="">
									<option value="">选择或搜索</option>
									<option value="1">完整版本</option>
									<option value="2">补丁版本</option>
								</select>
							</div>
						</div>
					</div>


					<div class="layui-form-item">
						<div class="layui-inline">
							<label class="layui-form-label">软件名称</label>
							<div class="layui-input-inline">
								<input type="text" name="verId" id="verId" lay-verify="text"
									autocomplete="off" class="layui-input">
							</div>
						</div>
						<div class="layui-inline">
							<label class="layui-form-label">版本号</label>
							<div class="layui-input-inline">
								<input type="text" name="verNo" id="verNo" lay-verify="text"
									autocomplete="off" class="layui-input">
							</div>
						</div>
					</div>

					<div class="layui-form-item">

						<div class="layui-inline">
							<label class="layui-form-label layui-required">版本申请人</label>
							<div class="layui-input-inline">
								<select lay-verify="required" id="applicant" lay-search="">
									<option value="">选择或搜索</option>
								</select>
							</div>
						</div>

						<div class="layui-inline">
							<label class="layui-form-label layui-required">配置管理员</label>
							<div class="layui-input-inline">
								<select lay-verify="required" id="cfgManager" lay-search="">
									<option value="">选择或搜索</option>
								</select>
							</div>
						</div>

						<div class="layui-inline" id="test">
							<label class="layui-form-label layui-required">测试负责人</label>
							<div class="layui-input-inline">
								<select lay-verify="required" id="testManager" lay-search="">
									<option value="">选择或搜索</option>
								</select>
							</div>
						</div>

						<div class="layui-inline" id="app">
							<label class="layui-form-label layui-required">版本审批人</label>
							<div class="layui-input-inline">
								<select lay-verify="required" id="appManager" lay-search="">
									<option value="">选择或搜索</option>
								</select>
							</div>
						</div>

						<!-- <div class="layui-inline">
							<label class="layui-form-label layui-required">版本发布人</label>
							<div class="layui-input-inline">
								<select lay-verify="required" id="publisher" lay-search="">
									<option value="">选择或搜索</option>
								</select>
							</div>
						</div> -->

					</div>

					<div class="layui-form-item layui-form-text">
						<label class="layui-form-label">版本描述</label>
						<div class="layui-input-block">
							<textarea  id="verInfo" placeholder="版本描述"
								autocomplete="off"  class="layui-textarea"></textarea>
						</div>
					</div>
					<div class="layui-form-item layui-form-text" id="build">
						<label class="layui-form-label">版本构建说明</label>
						<div class="layui-input-block">
							<textarea placeholder="应说明版本包由哪些部分组成，每一部分从哪里以何种方式获取"
								id="buildInfo"  class="layui-textarea"></textarea>
						</div>
					</div>

					<div class="layui-form-item layui-form-text" id="temp">
						<label class="layui-form-label">临时版本申请原因</label>
						<div class="layui-input-block">
							<input type="text" id="tempInfo" placeholder="临时版本申请原因"
								autocomplete="off" style="width: 81%" class="layui-input">
						</div>
					</div>
					
					<!-- <div class="layui-form-item layui-form-text">
						<label class="layui-form-label">发布说明</label>
						<div class="layui-input-block">
							<input type="text" id="pubComment" placeholder="发布说明"
								autocomplete="off" style="width: 81%" class="layui-input">
						</div>
					</div> -->

				</form>
			</div>
			<div class="layui-tab-item">
				<form class="layui-form">
					<div class="layui-form-item layui-form-text " id="appdiv">
						<label class="layui-form-label">版本审批说明</label>
						<div class="layui-input-block">
							<input type="text" id="appComment" placeholder="版本审批说明"
								autocomplete="off" style="width: 81%" class="layui-input">
						</div>
					</div>

					<div class="layui-form-item layui-form-text " id="builddiv">
						<label class="layui-form-label">版本构建备注</label>
						<div class="layui-input-block">
							<input type="text" id="buildComment" placeholder="版本构建备注"
								autocomplete="off" style="width: 81%" class="layui-input">
						</div>
					</div>

					<div class="layui-form-item layui-form-text">
						<label class="layui-form-label">版本提取路径</label>
						<div class="layui-input-block">
							<input type="text" id="verPath" placeholder="版本提取路径"
								autocomplete="off" style="width: 81%" class="layui-input">
						</div>
					</div>
					
					<hr class="layui-bg-green">

					<div class="layui-form-item">
						<div id="testtemp">
							<div class="layui-inline">
								<span><label class="layui-form-label layui-required">发现缺陷数</label></span>
							</div>
							<div class="layui-inline">
								<span><label class="layui-form-label layui-required">A级(致命)</label></span>
								<div class="layui-input-inline">
									<input type="number" style="width: 65px" id="fbuga"
										lay-verify="number|required" autocomplete="off"
										class="layui-input">
								</div>
							</div>
							<div class="layui-inline">
								<span><label class="layui-form-label layui-required">B级(严重)</label></span>
								<div class="layui-input-inline">
									<input type="number" style="width: 65px" id="fbugb"
										lay-verify="number|required" autocomplete="off"
										class="layui-input">
								</div>
							</div>
							<div class="layui-inline">
								<span><label class="layui-form-label layui-required">C级(一般)</label></span>
								<div class="layui-input-inline">
									<input type="number" style="width: 65px" id="fbugc"
										lay-verify="number|required" autocomplete="off"
										class="layui-input">
								</div>
							</div>
							<div class="layui-inline">
								<span><label class="layui-form-label layui-required">D级(轻微)</label></span>
								<div class="layui-input-inline">
									<input type="number" style="width: 65px" id="fbugd"
										lay-verify="number|required" autocomplete="off"
										class="layui-input">
								</div>
							</div>


							<div class="layui-form-item">
								<div class="layui-inline">
									<span><label class="layui-form-label layui-required">测试时间</label></span>
									<div class="layui-input-inline">
										<input type="text" class="layui-input" lay-verify="required"
											id="startTime" placeholder="yyyy-MM-dd HH:mm:ss">
									</div>
								</div>
								<div class="layui-inline">
									<label class="layui-form-label"
										style="text-align: center; width: 65px">-</label>
								</div>
								<div class="layui-inline">
									<div class="layui-input-inline">
										<input type="text" id="endTime" lay-verify="required"
											placeholder="yyyy-MM-dd HH:mm:ss" class="layui-input">
									</div>
								</div>
								<div class="layui-inline" id="testP">
									<label class="layui-form-label layui-required">测试人</label>
									<div class="layui-input-inline">
										<select lay-verify="required" name="testerManager" id="tester"
											lay-search="">
											<option value="">选择或搜索</option>
										</select>
									</div>
								</div>

								<div class="layui-inline" id="testR">
									<label class="layui-form-label layui-required">测试结论</label>
									<div class="layui-input-inline">
										<select lay-verify="required" id="testResult" lay-search="">
											<option value="">选择或搜索</option>
											<option value="1">通过</option>
											<option value="2">不通过</option>
										</select>
									</div>
								</div>
							</div>

							<!-- <div class="layui-form-item">
						
					</div> -->

							<div class="layui-form-item layui-form-text" id="reportdiv">
								<label class="layui-form-label">测试报告存放路径</label>
								<div class="layui-input-block">
									<input type="text" id="reportPath" placeholder="测试报告存放路径"
										autocomplete="off" style="width: 81%" class="layui-input">
								</div>
							</div>

							<div class="layui-form-item layui-form-text" id="testdiv">
								<label class="layui-form-label">测试结论说明</label>
								<div class="layui-input-block">
									<input type="text" id="testComment" placeholder="测试结论说明"
										autocomplete="off" style="width: 81%" class="layui-input">
								</div>
							</div>
						</div>
					</div>

					<div class="layui-form-item layui-form-text">
						<label class="layui-form-label">已通知人员</label>
						<div class="layui-input-block">
							<textarea id="infoPeople" class="layui-textarea"></textarea>
						</div>
					</div>
					<div class="layui-form-item layui-form-text">
						<label class="layui-form-label">已通知客户</label>
						<div class="layui-input-block">
							<textarea id="mails" class="layui-textarea"></textarea>
						</div>
					</div>
				</form>
			</div>
			<div class="layui-tab-item">
				<h2 style="margin-left: 1%">
					发布日志
					</h3>
					<ul style="margin-left: 8%" class="layui-timeline" id="formal"></ul>
			</div>
		</div>
	</div>

	<script src="../../layui-v2.5.6/layui/layui.js" charset="utf-8"></script>
	<!-- 注意：如果你直接复制所有代码到本地，上述js路径需要改成你本地的 -->
	<script>
var storage=window.localStorage;
var token = storage.getItem("token");

function initData(data){
	layui.use(['form','element'],function(){
		
		var testres = '';
		var status = data.status
		var publishTime = data.publishTime;
		var operator = data.operator;
		var mFlowNo = data.flowNo;
		var testResult = data.testResult;
		if(testResult == 1){
			testres = '通过';
		}else{
			testres = '不通过';
		}
		
		var form = layui.form;
		var element = layui.element;
		var flowNo = data.flowNo;
		var projName = data.projName;
		var deptId = data.deptId;
		var client = data.client;
		var product = data.product;
		var subPartNo = data.subPartNo;
		var testType = data.testType;
		var verType = data.verType;
		var verlevel = data.verlevel;
		var pkgType = data.pkgType;
		var verNo = data.verNo;
		var verId = data.verId;
		var cfgManager = data.cfgManager;
		var testManager = data.testManager;
		var createTime = data.createTime;
		var applicant = data.applicant;
		var applyTime =  data.applyTime;
		var builder = data.builder;
		var testTime =  data.testTime;
		var buildTime =  data.buildTime;
		var verPath = data.verPath;
		var verInfo = data.verInfo;
		var buildInfo = data.buildInfo;
		var tempInfo = data.tempInfo;
		var tester = data.tester;
		var publisher = data.publisher;
		var infoPeople = data.infoPeople;
		var fbuga = data.fbuga;
		var fbugb = data.fbugb;
		var fbugc = data.fbugc;
		var fbugd = data.fbugd;
		var startTime = data.startTime;
		var endTime = data.endTime;
		var reportPath = data.reportPath;
		var mails = data.mails;
		if(verType == 2){
	      $('#testtemp').addClass('layui-hide');
		}
		$('#buildInfo').val(buildInfo);
		$('#infoPeople').val(infoPeople);
		$('#fbuga').val(fbuga);
		$('#fbugb').val(fbugb);
		$('#fbugc').val(fbugc);
		$('#fbugd').val(fbugd);
		$('#startTime').val(startTime);
		$('#endTime').val(endTime);
		$('#reportPath').val(reportPath);
		if (verType == 1) {
			$('#testResult').val(testResult);
			$('#testManager').val(testManager);
			$('#app').addClass('layui-hide');
			$('#temp').addClass('layui-hide');
			$('#appdiv').addClass('layui-hide');
		} else {
			$('#tempInfo').val(tempInfo);
			$('#appManager').val(testManager);
			$('#test').addClass('layui-hide');
			//$('#build').addClass('layui-hide');
			$('#testP').addClass('layui-hide');
			$('#testR').addClass('layui-hide');
		  //$('#builddiv').addClass('layui-hide');
			$('#testdiv').addClass('layui-hide');
		}
		$.ajax({
			url:'/versions/getDistinctUR',
			type:'get',
			beforeSend:function(request){
				request.setRequestHeader("Authorization","Bearer "+token);
			},
			async:false,
			dataType:'json',
			success:function(res){
				var count = 0;
				for(var i=0; i<res.data.length; i++){ 
					if (applicant ==res.data[i].id ){
		    			$("#applicant").append("<option value='"+res.data[i].id+"' selected >"+res.data[i].realname+"("+res.data[i].username+")"+"</option>");
		    			count++;
		    		}
					if (tester ==res.data[i].id  && verType == '1'){
		    			$("#tester").append("<option value='"+res.data[i].id+"' selected >"+res.data[i].realname+"("+res.data[i].username+")"+"</option>"); 
		    			count++;
		    		}
					if (cfgManager ==res.data[i].id ){
		    			$("#cfgManager").append("<option value='"+res.data[i].id+"' selected >"+res.data[i].realname+"("+res.data[i].username+")"+"</option>"); 
		    			count++;
		    		}
					if (testManager ==res.data[i].id && verType == '1'){
		    			$("#testManager").append("<option value='"+res.data[i].id+"' selected >"+res.data[i].realname+"("+res.data[i].username+")"+"</option>");
		    			count++;
		    		}
					if (testManager ==res.data[i].id && verType == '2'){
		    			$("#appManager").append("<option value='"+res.data[i].id+"' selected >"+res.data[i].realname+"("+res.data[i].username+")"+"</option>"); 
		    			count++;
		    		}
					if (publisher ==res.data[i].id){
		    			$("#publisher").append("<option value='"+res.data[i].id+"' selected >"+res.data[i].realname+"("+res.data[i].username+")"+"</option>"); 
		    			count++;
		    		}
					if(count == 5){
						break;
					}
		    	}
				form.render('select');
			}
		});
		$.ajax({
			url:'/versions/erpDict',
			type:'get',
			beforeSend:function(request){
				request.setRequestHeader("Authorization","Bearer "+token);
			},
			async:false,
			dataType:'json',
			success:function(res){
				var data = res.data;
				for(var i=0; i<data.length; i++){ 
					if(data[i].type == 'product'){
						if(data[i].code == product){
						  $("#product").append("<option value='"+product+"' selected>"+product+"</option>");
						}else{
		    	          $("#product").append("<option value='"+data[i].code+"'>"+data[i].code+"</option>"); 
						}
					}else if(data[i].type == 'test'){
						var test1 = data[i].code+" "+data[i].name
					  	if(test1 == testType.trim()){
					  		$("#testType").append("<option value='"+testType+"' selected>"+testType+"</option>");
					  	}else{
		    	           $("#testType").append("<option value='"+data[i].code+" "+data[i].name+"'>"+data[i].code+" "+data[i].name+"</option>");
					  	}
					}else{
						var client1 = data[i].code+" "+data[i].name
						if(client1 == client.trim()){
						  $("#client").append("<option value='"+client+"' selected>"+client+"</option>");
						}else{
		    	     	  $("#client").append("<option value='"+data[i].code+" "+data[i].name+"'>"+data[i].code+" "+data[i].name+"</option>"); 
						}
					}
		    	}
				form.render('select');
			}
		});
		
		
		var opdata = [];
		//获取操作表的数据
		$.ajax({
			url:'/versions/'+mFlowNo+'/getProcess',
			type:'get',
			async:false,
			dataType:'json',
			success:function(res){
				if(res.msg == "success"){
					var resdata = res.data;
					for(var i =0;i<resdata.length;i++){
						//获取姓名
						$.ajax({
							url:'/versions/getNameById?operator='+resdata[i].operator,
							type:'get',
							async:false,
						    dataType:'json',
						    success:function(res){
						    	if(res.msg == "success"){
						    		resdata[i].operator = res.data.operator;
						    	}
						    }
						});
						opdata.push({"name":resdata[i].name,"opTime":resdata[i].opTime,"operator":resdata[i].operator,"comment":resdata[i].comment});
					}
				}
			}
		});
		//获取姓名
		$.ajax({
			url:'/versions/getNameById',
			type:'get',
			data:{cfgManager:cfgManager,tester:tester,testManager:testManager,publisher:publisher},
			async:false,
		    dataType:'json',
		    success:function(res){
		    	if(res.msg == "success"){
		    		cfgManager = res.data.cfgManager;
		    		tester = res.data.tester;
		    		testManager = res.data.testManager;
		    		publisher = res.data.publisher;
		    	}
		    }
		})
		for(var i=0;i<opdata.length;i++){
			if(opdata[i].name == "Apply"){
				var apply =  ' <li class="layui-timeline-item">'
					  +'  <i class="layui-icon layui-timeline-axis"></i>'
					  +'  <div class="layui-timeline-content layui-text">'
					  +'    <h3 class="layui-timeline-title">版本申请</h3>'
					  +'    <p>申请人:' +opdata[i].operator+ '</p>'
					  +'    <p>申请时间:' +dateFormat(opdata[i].opTime)+ '</p>'
					 
			if(verType == 1){
				apply = apply  +'<p>构建说明:'+buildInfo+'</p>'
				  +'  </div>'
				  +'</li>'
			}else{
				apply = apply  +'<p>临时版本申请原因:'+tempInfo+'</p>'
				  +'  </div>'
				  +'</li>'
			}
				$('#formal').append(apply);
			}
			if(opdata[i].name == "Build"){
				var build =  '<li class="layui-timeline-item">'
				  +'  <div class="layui-timeline-content layui-text">'
				  +'  <i class="layui-icon layui-timeline-axis"></i>'
				  +'     <h3 class="layui-timeline-title">版本构建</h3>'
				  +'    <p>构建人:' +opdata[i].operator+ '</p>'
				  +'    <p>构建完成时间:' +dateFormat(opdata[i].opTime)+ '</p>'
				  +'    <p>版本提取路径:'+verPath+'</p>'
				  +'  </div>'
				  +'</li>'
				  if(verType == 2){
					  build =  '<li class="layui-timeline-item">'
					  +'  <i class="layui-icon layui-timeline-axis"></i>'
					  +'  <div class="layui-timeline-content layui-text">'
					  +'     <h3 class="layui-timeline-title">版本已发布</h3>'
					  +'     <p>临时版本构建完成自动发布</p>'
					  +'</li>' + build 
				  }
				  $('#formal').append(build);
				  $('#buildComment').val(opdata[i].comment);
			}
			if(opdata[i].name == "Test"){
				var test =   '<li class="layui-timeline-item">'
				  +'  <i class="layui-icon layui-timeline-axis"></i>'
				  +'  <div class="layui-timeline-content layui-text">'
				  +'     <h3 class="layui-timeline-title">版本测试</h3>'
				  +'    <p>测试负责人:' +opdata[i].operator+ '</p>'
				  +'    <p>测试完成时间:' +dateFormat(opdata[i].opTime)+ '</p>'
				  +'    <p>测试人:'+tester+'</span></p>'
				  +'    <p>测试结果:'+testres+'</span></p>'
				  +'</li>'
				  test = '<li class="layui-timeline-item">'
				  +'  <i class="layui-icon layui-timeline-axis"></i>'
				  +'  <div class="layui-timeline-content layui-text">'
				  +'     <h3 class="layui-timeline-title">版本已发布</h3>'
				  +'    <p>正式版本测试通过自动发布</p>'
				  +'</li>' + test
				  $('#formal').append(test);
				  $('#testComment').val(opdata[i].comment);
			}
			if(opdata[i].name == "Discard"){
				var discard = '  <li class="layui-timeline-item">'
					  +'  <i class="layui-icon layui-timeline-axis"></i>'
					  +'  <div class="layui-timeline-content layui-text">'
					  +'    <h3 class="layui-timeline-title">版本废弃</h3>'
					  +'    <p>填写人:' +opdata[i].operator+ '</p>'
					  +'    <p>填写时间:' +dateFormat(opdata[i].opTime)+ '</p>'
					  +'    <p>废弃版本原因:' +opdata[i].comment+ '</p>'
					  +'  </div>'
					  +'</li>'
					  $('#formal').append(discard);
			}
			if(opdata[i].name == "Recover"){
				var recover = '  <li class="layui-timeline-item">'
					  +'  <i class="layui-icon layui-timeline-axis"></i>'
					  +'  <div class="layui-timeline-content layui-text">'
					  +'    <h3 class="layui-timeline-title">版本恢复</h3>'
					  +'    <p>恢复人:' +opdata[i].operator+ '</p>'
					  +'    <p>恢复时间:' +dateFormat(opdata[i].opTime)+ '</p>'
					  +'  </div>'
					  +'</li>'
					  $('#formal').append(recover);
			}
			/* if(opdata[i].name == "Publish"){
				var publish = '  <li class="layui-timeline-item">'
					  +'  <i class="layui-icon layui-timeline-axis"></i>'
					  +'  <div class="layui-timeline-content layui-text">'
					  +'    <h3 class="layui-timeline-title">版本发布</h3>'
					  +'    <p>版本发布人:' +opdata[i].operator+ '</p>'
					  +'    <p>版本发布时间:' +dateFormat(opdata[i].opTime)+ '</p>'
					  +'    <p>版本发布说明:' +opdata[i].comment+ '</p>'
					  +'  </div>'
					  +'</li>'
					  $('#formal').append(publish);
					  $('#pubComment').val(opdata[i].comment);
			} */
			if(opdata[i].name == "Approve"){
				var approve = '  <li class="layui-timeline-item">'
					  +'  <i class="layui-icon layui-timeline-axis"></i>'
					  +'  <div class="layui-timeline-content layui-text">'
					  +'    <h3 class="layui-timeline-title">版本审批</h3>'
					  +'    <p>版本审批人:' +opdata[i].operator+ '</p>'
					  +'    <p>版本审批完成时间:' +dateFormat(opdata[i].opTime)+ '</p>'
					  +'    <p>版本审批说明:' +opdata[i].comment+ '</p>'
					  +'  </div>'
					  +'</li>'
					  $('#formal').append(approve);
					  $('#appComment').val(opdata[i].comment);
			}
			if(opdata[i].name == "Rollback"){
				var roll = '  <li class="layui-timeline-item">'
					  +'  <i class="layui-icon layui-timeline-axis"></i>'
					  +'  <div class="layui-timeline-content layui-text">'
					  +'    <h3 class="layui-timeline-title">版本回退</h3>'
					  +'    <p>操作人:' +opdata[i].operator+ '</p>'
					  +'    <p>操作时间:' +dateFormat(opdata[i].opTime)+ '</p>'
					  +'  </div>'
					  +'</li>'
					  $('#formal').append(roll);
			}
			if(opdata[i].name == "Maintenance"){
				var roll = '  <li class="layui-timeline-item">'
					  +'  <i class="layui-icon layui-timeline-axis"></i>'
					  +'  <div class="layui-timeline-content layui-text">'
					  +'    <h3 class="layui-timeline-title">版本维护</h3>'
					  +'    <p>操作人:' +opdata[i].operator+ '</p>'
					  +'    <p>操作时间:' +dateFormat(opdata[i].opTime)+ '</p>'
					  +'  </div>'
					  +'</li>'
					  $('#formal').append(roll);
			}
			if(opdata[i].name == "Stop"){
				var stop = '  <li class="layui-timeline-item">'
					  +'  <i class="layui-icon layui-timeline-axis"></i>'
					  +'  <div class="layui-timeline-content layui-text">'
					  +'    <h3 class="layui-timeline-title">流程终止</h3>'
					  +'    <p>操作人:' +opdata[i].operator+ '</p>'
					  +'    <p>操作时间:' +dateFormat(opdata[i].opTime)+ '</p>'
					  +'  </div>'
					  +'</li>'
					  $('#formal').append(stop);
			}
		}
		
		
		
		$('#flowNo').val(flowNo);
		$('#projName').val(projName);
		$('#product').val(product);
		$('#deptId').val(deptId);
		$('#client').val(client);
		$('#subPartNo').val(subPartNo);
		$('#testType').val(testType);
		$('#verType').val(verType);
		$('#verlevel').val(verlevel);
		$('#pkgType').val(pkgType);
		$('#verNo').val(verNo);
		$('#verId').val(verId);
	//	$('#cfgManager').val(cfgManager);
		$('#createTime').val(createTime);
		$('#applicant').val(applicant);
		$('#applyTime').val(applyTime);
		$('#builder').val(builder);
		$('#buildTime').val(buildTime);
		$('#testTime').val(testTime);
		$('#verPath').val(verPath);
		$('#verInfo').val(verInfo);
		$('#mails').val(mails);
		form.render();
		form.render('select');
	});
}

function dateFormat(val) {
    if (val != null) {
    //	val = val - 28800000;
    	var val = val.toString();
        var date = new Date(parseInt(val.replace("/Date(", "").replace(")/", ""), 10));
        //月份为0-11所以+1，月份小于10补个0
        var month = date.getMonth() + 1 < 10 ? "0" + (date.getMonth() + 1) : date.getMonth() + 1;
        var currentDate = date.getDate() < 10 ? "0" + date.getDate() : date.getDate();
        var hour = date.getHours() < 10 ? "0" + date.getHours() : date.getHours();
        var minute = date.getMinutes() < 10 ? "0" + date.getMinutes() : date.getMinutes();
        var second = date.getSeconds() < 10 ? "0" + date.getSeconds() : date.getSeconds();
        var dd = date.getFullYear() + "-" + month + "-" + currentDate + " " + hour + ":" + minute + ":" + second;
        return dd;
    }
}

layui.use(['form', 'layedit', 'laydate'], function(){
	  var form = layui.form
	  ,laydate = layui.laydate;
	  //日期
	  laydate.render({
	    elem: '#startTime'
	    	,type:'datetime'
	  });
	  laydate.render({
	    elem: '#endTime'
	    ,type:'datetime'
	  });
	  
	  //自定义验证规则
	  form.verify({  
		  path: [
		    /^\//
		    ,'请检查测试报告存放路径是否正确'
		  ]
	  });
	  
	});
</script>

</body>
</html>