<!DOCTYPE html>
<html lang="zh-cn">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
<link rel="stylesheet" type="text/css" href="/static/h-ui/h-ui/css/H-ui.min.css">
<link rel="stylesheet" type="text/css" href="/static/h-ui/h-ui.admin/css/H-ui.admin.css" />
<link rel="stylesheet" href="/static/h-ui/h-ui/css/iconfont.css" media="all"/>
<link rel="stylesheet" href="/static/h-ui/h-ui.admin/skin/default/skin.css" id="skin">
<link rel="stylesheet" href="/static/h-ui/h-ui.admin/css/style.css" id="skin">
<link rel="stylesheet" type="text/css" href="/static/css/menu.css">
<link rel="stylesheet" type="text/css" href="/static/layui-v2.5.6/layui/css/modules/layer/default/layer.css" >
<link rel="stylesheet" type="text/css" href="/static/layui-v2.5.6/layui/css/layui.css">
<script type="text/javascript" src="/static/js/jquery-2.1.1.min.js"></script>
<script type="text/javascript" src="/static/js/easyui-lang-zh_CN.js"></script>

<script src="/static/layui-v2.5.6/layui/layui.all.js"></script> 
<script src="/static/layui-v2.5.6/layui/layui.js"></script>  
<script type="text/javascript" src="/static/layui-v2.5.6/layui/lay/modules/layer.js"></script>
<script type="text/javascript" src="/static/h-ui/h-ui/js/H-ui.min.js"></script>
<script type="text/javascript" src="/static/h-ui/h-ui.admin/js/H-ui.admin.js"></script>
<script type="text/javascript" src="/static/h-ui/h-ui/js/H-ui.js"></script>
<script type="text/javascript" src="/static/templates/access_record/access_record.js"></script>

<script src="/static/js/Amaranjs/jquery.amaran.js"></script>  
<script src="/static/js/Amaranjs/jquery.amaran.min.js"></script>  
<link rel="stylesheet" href="/static/css/Amaranjs/amaran.min.css" >
<link rel="stylesheet" href="/static/css/Amaranjs/animate.min.css">

<!-- webSocket -->
<script type="text/javascript" src="/static/js/sockjs.min.js"></script>
<script type="text/javascript" src="/static/js/worktime.js"></script>
<style type="text/css">
html {
	display: none
}

.layui-layer-content {
	position: relative;
	padding: -1px;
	padding-bottom: 78px;
	line-height: 53px;
	word-break: break-all;
	overflow: hidden;
	font-size: 14px;
	overflow-x: hidden;
	overflow-y: auto;
}

.layui-layer-btn {
	text-align: right;
	padding: -1px 15px 12px;
	position: absolute;
	top: 145px;
	left: 53px;
	pointer-events: auto;
	user-select: none;
	-webkit-user-select: none;
}

.show_iframe{
	width:100%;
	height:100%;
}

.list ul li ul li a {
    padding-left: 30px;
    color: #c2c2c2;
}

</style>
<script language="JavaScript"> 
javascript:window.history.forward(1); 
</script> 
<script>
	if (self == top) {
		document.documentElement.style.display = 'block'
	} else {
		top.location = self.location
	}	
</script>
 


<title>燕麦科技版本发布系统</title>
 
<style type="text/css">
#Hui-nav li#Huinav_2 a,
#Hui-nav li#Huinav_2 a:hover { color: #fff; background-color: #111 }
</style>
</head>
<body>
<header class="navbar-wrapper">
	<div class="navbar navbar-black">
		<div class="container-fluid cl"> <a class="logo navbar-logo hidden-xs" href="#">版本发布系统</a><span class="logo navbar-slogan hidden-xs">&nbsp;v1.0</span><a aria-hidden="false" class="nav-toggle Hui-iconfont visible-xs" href="javascript:;">&#xe667;</a>
			<nav id="Hui-userbar" class="nav navbar-nav navbar-userbar hidden-xs">
                <ul class="cl">
                    <li id="usernam"></li>
                    <li class="dropDown dropDown_hover">
                        <a href="#" class="dropDown_A"> <i class="Hui-iconfont">&#xe6d5;</i></a>
                        <ul class="dropDown-menu menu radius box-shadow">
                            <li><a target="_parent" href="javascript:void(0)" onclick="quitSystem()">退出</a></li>
                            <li><a  href="javascript:void(0)" onclick="accessRecord()">访问记录</a></li>
                        </ul>
                    </li>
                    <li id="Hui-skin" class="dropDown right dropDown_hover">
                        <a href="javascript:;" class="dropDown_A" title="换肤"><i class="Hui-iconfont" style="font-size:18px">&#xe62a;</i></a>
                        <ul class="dropDown-menu menu radius box-shadow">
                            <li><a href="javascript:;" data-val="default" title="默认（黑色）">默认（黑色）</a></li>
                            <li><a href="javascript:;" data-val="blue" title="蓝色">蓝色</a></li>
                            <li><a href="javascript:;" data-val="green" title="绿色">绿色</a></li>
                            <li><a href="javascript:;" data-val="red" title="红色">红色</a></li>
                            <li><a href="javascript:;" data-val="yellow" title="黄色">黄色</a></li>
                            <li><a href="javascript:;" data-val="orange" title="橙色">橙色</a></li>
                        </ul>
                    </li>
                </ul>
            </nav>
		</div>
	</div>
	<input type="hidden" id="timeId"/>
<script>
 

function closeButton(obj){
	layer.closeAll();
}
</script>	 
</header> 
 <aside class="Hui-aside" style="padding-top:inherit">
  <div id="menubox" class="list">
	<ul>
		<li class="menu_li">
		    <li class="layui-icon" aria-hiden="true">
			    <a style="color:white;font-size:15px;padding-left:20px;" href="#" id ="verManager" class="inactive" >&#xe656 版本管理</a>
			    <ul id="verul">
			    	<li class="menu_li">
			    		<a data-title="待我处理" onclick="Hui_admin_tab(this)" data-href="/static/templates/mywork/mydo.html">&#xe667 待我处理</a>
			    	</li>
			    	<li class="menu_li">
			    		<a data-title="我处理的" onclick="Hui_admin_tab(this)" data-href="/static/templates/mywork/mydone.html">&#xe66f 我处理的</a>
			    	</li>
			    	<li class="menu_li">
			    		<a data-title="版本申请" onclick="Hui_admin_tab(this)" data-href="/static/templates/ver_manage/ver_apply.html">&#xe621 版本申请</a>
			    	</li>
			    	<li class="menu_li">
			    		<a data-title="发布版本查询" onclick="Hui_admin_tab(this)" data-href="/static/templates/ver_manage/ver_search.html">&#xe615 发布版本查询</a>
			    	</li>
			    	<li class="menu_li">
			    		<a data-title="已废弃版本" onclick="Hui_admin_tab(this)" data-href="/static/templates/ver_manage/discard/ver_discard_search.html">&#x1006 已废弃版本</a>
			    	</li>
			    </ul>
		    </li>
		<li class="menu_li">
		    <li class="layui-icon" aria-hiden="true" >
			    <a style="color:white;font-size:15px;padding-left:20px;" href="javascript:void(0);" class="inactive" >&#xe658 权限管理</a>
			    <ul id="sysli">
			    	<li class="menu_li">
			    		<a data-title="产品软件关键字" onclick="Hui_admin_tab(this)" data-href="/static/templates/define_keywords/keywords_search.html">&#xe66a  产品软件关键字</a>
			    	</li>
			    	<li class="menu_li">
			    		<a data-title="我的通知人员分组" onclick="Hui_admin_tab(this)" data-href="/static/templates/mywork/myGroup/my_group.html">&#xe613 我的通知人员分组</a>
			    	</li>
			    </ul>
			    	 <!--<li class="menu_li">
			    		 <a data-title="角色管理" href="javascript:void(0);" class="inactive">&#xe613 角色管理</a>
			    		<ul>
			    				<li class="menubtnli">
			    					<a data-title="新增角色" onclick="Hui_admin_tab(this)" data-href="/static/templates/sec_manage/addrole.html">&#xe66f 新增角色</a>
			    				</li>
			    				<li class="menubtnli">
			    					<a data-title="关联用户" onclick="Hui_admin_tab(this)" data-href="/static/templates/sec_manage/relate_user.html">&#xe66f 关联用户</a>
			    				</li>
			    		</ul> 
			    	</li>
			    </ul>-->
			 </li>
		</li>
	 </ul>
 </div>   
</aside> 

<div class="dislpayArrow hidden-xs"><a class="pngfix" href="javascript:void(0);" onClick="displaynavbar(this)"></a></div>
<section class="Hui-article-box">
	 
	<div id="Hui-tabNav" class="Hui-tabNav hidden-xs">
        <div class="Hui-tabNav-wp">
            <ul id="min_title_list" class="acrossTab cl">
                <li class="active">
                    <span title="首页" data-href="">首页</span>
                    <em></em>
                </li>
            </ul>
        </div>
        <div class="Hui-tabNav-more btn-group"><a id="js-tabNav-prev" class="btn radius btn-default size-S" href="javascript:;"><i class="Hui-iconfont">&#xe6d4;</i></a><a id="js-tabNav-next" class="btn radius btn-default size-S" href="javascript:;"><i class="Hui-iconfont">&#xe6d7;</i></a></div>
    </div>
    <div id="iframe_box" class="Hui-article">
        <div class="show_iframe" style="width:100%;height:100%">
            <div style="display:none" class="loading"></div>
            <iframe  id="detailsID" src="/static/index_detail.html"></iframe>
        </div>
    </div>	
</section>
<div class="contextMenu" id="Huiadminmenu">
    <ul>
        <li id="closethis">关闭当前 </li>
        <li id="closeall">关闭全部 </li>
    </ul>
</div>
<script type="text/javascript" src="js/menu-operate.js"></script>
<script type="text/javascript" src="h-ui/h-ui.admin/js/H-ui.admin.js"></script>
<script>
$(function(){
	$('#verManager').click();
})

//获取erp接口返回的token储存在localStorage
var token = '';
function getToken(){
	$.ajax({
		url:"/versions/getToken",
		type:'get',
		async:false,
		dataType:'json',
		success:function(res){
			if(res.msg == "success"){
				token = res.token;
			}else{
				window.location.href = "http://erp.yanmade.com";
			}
		}
	})
}
getToken();
var storage=window.localStorage;
storage.setItem("token",token);
init();
function init(){
  $.ajax({
	  url:'/users/authority',
	  type:'get',
	  beforeSend:function(request){
			request.setRequestHeader("Authorization","Bearer "+token);
	  },
	  async:false,
	  dataType:'json',
	  success:function(res){
		  if(res.status == 200){
			  var data = res.data.authority;
			  if(data.indexOf('version.maintenance') > -1){
				  $('#verul').append('<li class="menu_li">'
			    	+'<a data-title="版本维护" onclick="Hui_admin_tab(this)" data-href="/static/templates/ver_manage/ver_keep.html">&#xe646 版本维护</a>'
			    	+'</li>')
			  }
			    if(data.indexOf('system.admin') > -1 && data.indexOf('user.admin') > -1 && data.indexOf('role.admin') > -1 && data.indexOf('data.department')){
			    	$('#sysli').append(
					    	 '<li class="menu_li">'
				    		+'<a data-title="版本申请分组" onclick="Hui_admin_tab(this)" data-href="/static/templates/sec_manage/apply_group/apply_group.html">&#xe613 版本申请分组</a>'
				    		+'</li>'
					    	+'<li class="menu_li">'
				    		+'<a data-title="用户管理" onclick="Hui_admin_tab(this)" data-href="/static/templates/sec_manage/user_manage.html">&#xe613 用户管理</a>'
				    		+'</li>'
					    	+'<li class="menu_li">'
				    		+'<a data-title="角色管理" onclick="Hui_admin_tab(this)" data-href="/static/templates/sec_manage/role_manage.html">&#xe613 角色管理</a>'
				    		+'</li>'
					    	+'<li class="menu_li">'
				    		+'<a data-title="数据同步" onclick="Hui_admin_tab(this)" data-href="/static/templates/sec_manage/data_dept.html">&#xe613 数据同步</a>'
				    		+'</li>')
			    }else if(data.indexOf('system.admin') > -1 && data.indexOf('user.admin')){
			    	$('#sysli').append(
					    	 '<li class="menu_li">'
				    		+'<a data-title="用户管理" onclick="Hui_admin_tab(this)" data-href="/static/templates/sec_manage/user_manage.html">&#xe613 用户管理</a>'
				    		+'</li>')
			    }else if(data.indexOf('system.admin') > -1 && data.indexOf('role.admin') > -1){
			    	$('#sysli').append(
					    	 '<li class="menu_li">'
				    		+'<a data-title="角色管理" onclick="Hui_admin_tab(this)" data-href="/static/templates/sec_manage/role_manage.html">&#xe613 角色管理</a>'
				    		+'</li>')
			    }
		  }else{
			  window.location.href ="http://erp.yanmade.com";
		  }
	  },
	  error:function(){
		  layer.msg('功能权限获取出错了!',{time:1000});
	  }
  })
};

function quitSystem(){
	storage.setItem("token","");
	$.ajax({
		url:'/token',
		type:'delete',
		dataType:'json',
		success:function(res){
		//	location.href ="http://erp.yanmade.com/ProMain/Login";
		}
	})
}
</script>
<script>
//查询当前页面的访问记录
function  accessRecord(){
	 var prefix = window.location.href;
	 prefix = prefix.replace("http://","");
	 prefix = prefix.substr(0,prefix.indexOf("/"));
	 var url = $('.active span')[0].dataset.href;
	 url = prefix + url;
	 if(url != '' || url != undefined){
		 if(url.endsWith("#")){
			 url = url.substr(0,url.length-1)
		 }
	 }
	 layer.open({
		  type:2,
		  title:'页面访问记录',
		  shadeClose: true,
	      shade: 0.8,
	      scrollbar: false,
	      resize:false,
	      area: ['40%', '90%'],
	      content: '/static/templates/access_record/access_record.html?url='+encodeURIComponent(url),
	      success:function(layero,index){
	      }
	  
	  });
}

	$('.inactive').click(function(){
		if($(this).siblings('ul').css('display')=='none'){
			$(this).parent('li').siblings('li').removeClass('inactives');
			$(this).addClass('inactives');
			$(this).siblings('ul').slideDown(100).children('li');
			if($(this).parents('li').siblings('li').children('ul').css('display')=='block'){
				$(this).parents('li').siblings('li').children('ul').parent('li').children('a').removeClass('inactives');
				$(this).parents('li').siblings('li').children('ul').slideUp(100);

			}
		}else{
			//控制自身变成+号
			$(this).removeClass('inactives');
			//控制自身菜单下子菜单隐藏
			$(this).siblings('ul').slideUp(100);
			//控制自身子菜单变成+号
			$(this).siblings('ul').children('li').children('ul').parent('li').children('a').addClass('inactives');
			//控制自身菜单下子菜单隐藏
			$(this).siblings('ul').children('li').children('ul').slideUp(100);
			//控制同级菜单只保持一个是展开的（-号显示）
			$(this).siblings('ul').children('li').children('a').removeClass('inactives');
		}
	})
	var btn=$(".menubtnli");
        for(var i=0;i<btn.length;i++){
                btn[i].onclick=function(){
                        for(var j=0;j<btn.length;j++){
                                btn[j].className="menubtnli";
                                $(btn[j]).children().css("color","#c2c2c2");
                        }
                        this.className="menubtnli active";
                        $(this).children().css("color","#fff");
                        /* var str_id=$(this).children("a")[0].getAttribute("targe");
                        addMenuTotal(str_id); */
                }
        } 

</script>
</body>
</html>