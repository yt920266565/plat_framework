<!DOCTYPE html>
<html lang="zh-cn">
<head>
	<meta charset="utf-8"> 
	<title></title>
	<link rel="stylesheet" href="/static/css/bootstrap.min.css">
	 <link rel="stylesheet" href="/static/layui-v2.5.6/layui/css/layui.css"  media="all">
	<script src="/static/js/jquery-2.1.1.min.js"></script>
	<script src="/static/layui-v2.5.6/layui/layui.js"></script> 
	<script type="text/javascript" src="/static/layui-v2.5.6/layui/lay/modules/layer.js"></script>
<script type="text/javascript" src="/static/h-ui/h-ui/js/H-ui.min.js"></script>
<script type="text/javascript" src="/static/h-ui/h-ui.admin/js/H-ui.admin.js"></script>
<script type="text/javascript" src="/static/h-ui/h-ui/js/H-ui.js"></script>
<script type="text/javascript" src="/static/templates/access_record/access_record.js"></script>
  <script src="/static/layui-v2.5.6/layui/layui.all.js" charset="utf-8"></script>
  <link rel="stylesheet" type="text/css" href="/static/h-ui/h-ui/css/H-ui.min.css">
<link rel="stylesheet" type="text/css" href="/static/h-ui/h-ui.admin/css/H-ui.admin.css" />
<link rel="stylesheet" href="/static/h-ui/h-ui/css/iconfont.css" media="all"/>
<link rel="stylesheet" href="/static/h-ui/h-ui.admin/skin/default/skin.css" id="skin">
<link rel="stylesheet" href="/static/h-ui/h-ui.admin/css/style.css" id="skin">
   <script src="/static/js/formatDate_cs.js" charset="utf-8"></script>
  
</head>
<script type="text/javascript" src="h-ui/h-ui.admin/js/H-ui.admin.js"></script>
<style type="text/css">
   .body{overflow-y:auto;height: 210px;}
</style>
<script type="text/html" id="barDemo">
  <a class="layui-btn layui-btn-xs ModifyButPower" id="deal" lay-event="deal">查看</a>
</script> 
<script type="text/html" id="barDemo1">
  <a class="layui-btn layui-btn-xs ModifyButPower" id="deal" lay-event="deal">查看</a>
</script> 
<script type="text/javascript">
var storage=window.localStorage;
var token = storage.getItem("token");

</script>
 <style>
     .table>tbody>tr>td{
         vertical-align:middle
     }
</style>
<body>
<div style="height: 200px;">
 <img id = "home" style=" width: -webkit-fill-available; height: -webkit-fill-available;position: absolute;" alt="燕麦科技"  src="/static/images/homepage4.png" />
<div class="panel panel-success" style="height: 250px;width: 500px;left: 50px;top:60px;position:absolute;">
	<div class="panel-heading">
		<div style="display:inline-block" class="panel-title" >待我处理</div>
	</div>
		<table class="table table-striped table-hover " id="mydotab" >
		</table>
		<div id="mydo" style="text-align:right;">></div>
		</div>
	
</div>
<div class="panel panel-info" style="height: 250px;width: 500px;position: absolute;top: 60px;left: 580px;">
	<div class="panel-heading">
		<div style="display:inline-block" class="panel-title" >超过七天未发布的版本</div>
	</div>
	<table class="table table-striped table-hover " id="delay" >
		</table>
		<div id="delaydiv" style="text-align:right">></div>
</div>
<div class="panel panel-warning" style="height: 250px;width: 500px;left: 50px;top:330px;position:absolute;">
	<div class="panel-heading">
		<div style="display:inline-block" class="panel-title" >最新发布的正式版本</div>
		<div style="margin-right:30px;display:inline-block;float:right;"><a  onclick='Hui_admin_tab(this)' data-title="最新发布正式版本" data-href='/static/templates/ver_manage/ver_search.html?verType=1' style="color:blue;float:right;">所有..</a></div>
	</div>
	<table class="table table-striped table-hover " id="latestPub" >
		</table>
		<div id="latestPub1" style="text-align:right">></div>
		</div>
<div class="panel panel-danger" style="height: 250px;width: 500px;position: absolute;top: 330px;left: 580px;">
	<div class="panel-heading">
		<div style="display:inline-block" class="panel-title" >最新发布的临时版本</div>
		<div style="margin-right:30px;display:inline-block;float:right;"><a  onclick='Hui_admin_tab(this)' data-title="最新发布临时版本" data-href='/static/templates/ver_manage/ver_search.html?verType=2' style="color:blue;float:right;">所有..</a></div>
	</div>
	<table class="table table-striped table-hover " id="latestTem" >
		</table>
		<div id="latestTem1" style="text-align:right">></div>
</div>
<script type="text/javascript">
var storage=window.localStorage;
var token = storage.getItem("token");
$(function(){
var htmlStr="<thead><tr><th>项目名称</th><th>版本流水号</th><th>产品线</th><th>软件名称</th><th>版本号</th><th>操作</th></tr></thead>"
	  $.ajax({
	  	type : 'get',
		url : '/versions/mydo.action',
		beforeSend:function(request){
			request.setRequestHeader("Authorization","Bearer "+token);
		},
		dataType : 'json',
		success : function(res){
			layui.use(['laypage', 'layer'], function(){
			  var laypage = layui.laypage
			  ,layer = layui.layer;
			//调用分页
			  laypage.render({
			    elem: 'mydo'
			    ,count: res.data.length
			    ,limit:2
			    ,layout: ['prev', 'next']
			    ,jump: function(obj){
			      var curr=obj.curr;
			      //模拟渲染
			      document.getElementById('mydotab').innerHTML = function(){
			        var arr = []
			        ,thisData = res.data.concat().splice(obj.curr*obj.limit - obj.limit, obj.limit);
			        arr.push(htmlStr);
			        layui.each(thisData, function(index, item){
			        	if(item.deptId == 134){
			        		item.deptId = '产品一部';
			        	}else if(item.deptId == 132){
			        		item.deptId = '产品二部';
			        	}else if(item.deptId == 133){
			        		item.deptId = '产品三部';
			        	}else if(item.deptId == 135){
			        		item.deptId = '产品四部';
			        	}else if(item.deptId == 162){
			        		item.deptId = '产品五部';
			        	}else if(item.deptId == 136){
			        		item.deptId = '派科斯';
			        	}else if(item.deptId == 155){
			        		item.deptId = '软件部';
			        	}else{item.deptId = '产品线';}
		         		 arr.push("<tbody text-align:center>"+"<tr><td>"+(item.projName)+"</td>"+"<td>"+item.flowNo+"</td>"+
						"<td>"+item.deptId+"</td>"+"<td>"+item.verId+"</td>"+"<td>"+item.verNo+"</td>"+
						"<td><button class='layui-btn layui-btn-normal layui-btn-radius' onclick='deal("+JSON.stringify(item)+")'>处理</button></td></tr>"+"</tbody>");
			        });
			        return arr.join('');
			      }();
			    }
			  });
			  
		});
		} 
	   }); 
	  $.ajax({
	  	type : 'get',
		url : '/versions/verMain.action',
		beforeSend:function(request){
			request.setRequestHeader("Authorization","Bearer "+token);
		},
		dataType : 'json',
		success : function(res){
			layui.use(['laypage', 'layer'], function(){
			  var laypage = layui.laypage
			  ,layer = layui.layer;
			//调用分页
			  laypage.render({
			    elem: 'delaydiv'
			    ,count: res.data.length
			    ,limit:2
			    ,layout: ['prev', 'next']
			    ,jump: function(obj){
			      var curr=obj.curr;
			      //模拟渲染
			      document.getElementById('delay').innerHTML = function(){
			        var arr = []
			        ,thisData = res.data.concat().splice(obj.curr*obj.limit - obj.limit, obj.limit);
			        arr.push(htmlStr);
			        layui.each(thisData, function(index, item){
			        	if(item.deptId == 134){
			        		item.deptId = '产品一部';
			        	}else if(item.deptId == 132){
			        		item.deptId = '产品二部';
			        	}else if(item.deptId == 133){
			        		item.deptId = '产品三部';
			        	}else if(item.deptId == 135){
			        		item.deptId = '产品四部';
			        	}else if(item.deptId == 162){
			        		item.deptId = '产品五部';
			        	}else if(item.deptId == 136){
			        		item.deptId = '派科斯';
			        	}else if(item.deptId == 155){
			        		item.deptId = '软件部';
			        	}else{item.deptId = '产品线';}
		         		 arr.push("<tbody text-align:center>"+"<tr><td>"+(item.projName)+"</td>"+"<td>"+item.flowNo+"</td>"+
						"<td>"+item.deptId+"</td>"+"<td>"+item.verId+"</td>"+"<td>"+item.verNo+"</td>"+
						"<td><button class='layui-btn layui-btn-normal layui-btn-radius' onclick='dealdealy("+JSON.stringify(item)+")'>详情</button></td></tr>"+"</tbody>");
			        });
			        return arr.join('');
			      }();
			    }
			  });
			  
		});
		} 
	   }); 
	  $.ajax({
	  	type : 'get',
		url : '/versions/published?verType='+1,
		beforeSend:function(request){
			request.setRequestHeader("Authorization","Bearer "+token);
		},
		dataType : 'json',
		success : function(res){
			layui.use(['laypage', 'layer'], function(){
			  var laypage = layui.laypage
			  ,layer = layui.layer;
			//调用分页
			  laypage.render({
			    elem: 'latestPub1'
			    ,count: res.data.length
			    ,limit:2
			    ,layout: ['prev', 'next']
			    ,jump: function(obj){
			      var curr=obj.curr;
			      //模拟渲染
			      document.getElementById('latestPub').innerHTML = function(){
			        var arr = []
			        ,thisData = res.data.concat().splice(obj.curr*obj.limit - obj.limit, obj.limit);
			        arr.push(htmlStr);
			        layui.each(thisData, function(index, item){
			        	if(item.deptId == 134){
			        		item.deptId = '产品一部';
			        	}else if(item.deptId == 132){
			        		item.deptId = '产品二部';
			        	}else if(item.deptId == 133){
			        		item.deptId = '产品三部';
			        	}else if(item.deptId == 135){
			        		item.deptId = '产品四部';
			        	}else if(item.deptId == 162){
			        		item.deptId = '产品五部';
			        	}else if(item.deptId == 136){
			        		item.deptId = '派科斯';
			        	}else if(item.deptId == 155){
			        		item.deptId = '软件部';
			        	}else{item.deptId = '产品线';}
		         		 arr.push("<tbody text-align:center>"+"<tr><td>"+(item.projName)+"</td>"+"<td>"+item.flowNo+"</td>"+
						"<td>"+item.deptId+"</td>"+"<td>"+item.verId+"</td>"+"<td>"+item.verNo+"</td>"+
						"<td><button class='layui-btn layui-btn-normal layui-btn-radius' onclick='Hui_admin_tab(this)' data-title='详情' data-href='/static/templates/ver_manage/ver_search.html?flowNo="+item.flowNo+"'>详情</button></td></tr>"+"</tbody>");
			        });
			        return arr.join('');
			      }();
			    }
			  });
			  
		});
		} 
	   }); 
	  $.ajax({
	  	type : 'get',
		url : '/versions/published?verType='+2,
		beforeSend:function(request){
			request.setRequestHeader("Authorization","Bearer "+token);
		},
		dataType : 'json',
		success : function(res){
			layui.use(['laypage', 'layer'], function(){
			  var laypage = layui.laypage
			  ,layer = layui.layer;
			//调用分页
			  laypage.render({
			    elem: 'latestTem1'
			    ,count: res.data.length
			    ,limit:2
			    ,layout: ['prev', 'next']
			    ,jump: function(obj){
			      var curr=obj.curr;
			      //模拟渲染
			      document.getElementById('latestTem').innerHTML = function(){
			        var arr = []
			        ,thisData = res.data.concat().splice(obj.curr*obj.limit - obj.limit, obj.limit);
			        arr.push(htmlStr);
			        layui.each(thisData, function(index, item){
			        	if(item.deptId == 134){
			        		item.deptId = '产品一部';
			        	}else if(item.deptId == 132){
			        		item.deptId = '产品二部';
			        	}else if(item.deptId == 133){
			        		item.deptId = '产品三部';
			        	}else if(item.deptId == 135){
			        		item.deptId = '产品四部';
			        	}else if(item.deptId == 162){
			        		item.deptId = '产品五部';
			        	}else if(item.deptId == 136){
			        		item.deptId = '派科斯';
			        	}else if(item.deptId == 155){
			        		item.deptId = '软件部';
			        	}else{item.deptId = '产品线';}
		         		 arr.push("<tbody text-align:center>"+"<tr><td>"+(item.projName)+"</td>"+"<td>"+item.flowNo+"</td>"+
						"<td>"+item.deptId+"</td>"+"<td>"+item.verId+"</td>"+"<td>"+item.verNo+"</td>"+
						"<td><button class='layui-btn layui-btn-normal layui-btn-radius' onclick='Hui_admin_tab(this)' data-title='详情' data-href='/static/templates/ver_manage/ver_search.html?flowNo="+item.flowNo+"'>详情</button></td></tr>"+"</tbody>");
			        });
			        return arr.join('');
			      }();
			    }
			  });
			  
		});
		} 
	   }); 
});
//待我处理
function deal(item){
	item = getitem(item);
layui.use('table', function(){
	  var table = layui.table;
	  var status = item.status;
	  var title = ''
	   /* if(status == 2){ //待构建
		//  content = '/static/templates/ver_manage/ver_build.html'
		//  title = '版本待构建';
	  }else if(status == 3){ //待测试
		//  content = '/static/templates/ver_manage/ver_test.html'
		//	  title = '版本待测试';
	  }else if(status == 4){  //待发布
		//  content = '/static/templates/ver_manage/ver_publish.html'
		//	  title = '版本待发布';
	  }else if(status == 5){  //待审批
		//  content = '/static/templates/ver_manage/ver_approval.html'
		//	  title = '版本待审批';
	  }else{} */
	 top.layer.open({
		  type:2,
		  title:title,
		  shadeClose: false,
	      shade: 0,
	      scrollbar: false,
	      resize:false,
	      offset:['125px','245px'],
	      area: ['85%', '80%'],
	      content: '/static/templates/mywork/mydone_process.html',
	      success:function(layero,index){
	    	//var iframeWin = window['layui-layer-iframe' + index];
	    	var iframeWin = top[layero.find('iframe')[0]['name']];
          iframeWin.initData(item,'mydo');//调用修改窗口的初始化方法
	      }
	  });
});
}
//超过七天未发布的版本
function dealdealy(item){
	item = getitem(item);
	var title = '';
layui.use('table', function(){
	  var table = layui.table;
	  var status = item.status;
	  /* if(status == 1){  //待申请
		  content = '/static/templates/ver_manage/ver_apply_edit.html';
		  title = '版本待申请';
	  }else if(status == 2){ //待构建
		  content = '/static/templates/ver_manage/ver_build.html'
		  title = '版本待构建';
	  }else if(status == 3){ //待测试
		  content = '/static/templates/ver_manage/ver_test.html'
			  title = '版本待测试';
	  }else if(status == 4){  //待发布
		  content = '/static/templates/ver_manage/ver_publish.html'
			  title = '版本待发布';
	  }else if(status == 5){  //待审批
		  content = '/static/templates/ver_manage/ver_approval.html'
			  title = '版本待审批';
	  }else{} */
	  top.layer.open({
		  type:2,
		  title:title,
		  shadeClose: false,
	      shade: 0,
	      scrollbar: false,
	      resize:false,
	      offset:['125px','245px'],
	      area: ['85%', '80%'],
	      content: '/static/templates/mywork/mydone_process.html',
	      success:function(layero,index){
	    	//var iframeWin = window['layui-layer-iframe' + index];
	    	var iframeWin = top[layero.find('iframe')[0]['name']];
          iframeWin.initData(item,'');//调用修改窗口的初始化方法
	      }
	  });
});
}
//跳转到版本查询页面并查询指定的flowNo  正式
function dealPub(flowNo){
	window.location.href = '/static/templates/ver_manage/ver_search.html?flowNo='+flowNo;
}
//跳转到版本查询页面并查询指定的flowNo  临时
function dealTemp(flowNo){
	window.location.href = '/static/templates/ver_manage/ver_search.html?flowNo='+flowNo;
}

function getitem(item){
	if(item.deptId == '产品一部'){
		item.deptId = 134;
	}else if(item.deptId == '产品二部'){
		item.deptId = 132;
	}else if(item.deptId == '产品三部'){
		item.deptId = 133;
	}else if(item.deptId == '产品四部'){
		item.deptId = 135;
	}else if(item.deptId == '产品五部'){
		item.deptId = 162;
	}else if(item.deptId == '派科斯'){
		item.deptId = 136;
	}else if(item.deptId == '软件部'){
		item.deptId = 155;
	}
	return item;
}


</script>	
</body>
</html>